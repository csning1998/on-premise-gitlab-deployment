# Generic Redis Configuration
bind {{ advertise_ip }} 127.0.0.1
port 6379
protected-mode yes
daemonize no
pidfile /var/run/redis/redis-server.pid
loglevel notice
logfile /var/log/redis/redis-server.log

# Systemd Integration
supervised systemd

# Working Directory
dir /var/lib/redis

# Persistence
appendonly yes
appendfsync everysec

# Security
requirepass {{ redis_requirepass }}

# For replication, specify the user and pwd to authenticate with the master, where 'masteruser' is required for Redis 6+ with ACLs.
masteruser default
masterauth {{ redis_masterauth }}

# Replication: Only configured if this node is defined as a replica in inventory
{% if inventory_hostname in (groups['redis_replicas'] | default([])) %}
# Note: redis_initial_master_ip must be defined in inventory or group_vars
replicaof {{ redis_initial_master_ip }} 6379
{% endif %}
