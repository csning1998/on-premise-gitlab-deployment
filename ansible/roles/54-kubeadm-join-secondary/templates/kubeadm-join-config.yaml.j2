---
apiVersion: kubeadm.k8s.io/v1beta4
kind: JoinConfiguration
nodeRegistration:
  name: "{{ inventory_hostname }}"
  kubeletExtraArgs:
    - name: "cgroup-driver"
      value: "{{ k8s_cgroup_driver }}"
discovery:
  bootstrapToken:
    apiServerEndpoint: "{{ kubeadm_ha_virtual_ip }}:6443"
    token: "{{ hostvars[groups['master'][0]]['kubeadm_token'] }}"
    caCertHashes:
      - "sha256:{{ hostvars[groups['master'][0]]['kubeadm_ca_hash'] }}"
    unsafeSkipCAVerification: {{ k8s_join_skip_ca_verification | lower }}
controlPlane:
  localAPIEndpoint:
    advertiseAddress: "{{ kubeadm_advertise_ip }}"
  certificateKey: "{{ hostvars[groups['master'][0]]['kubeadm_cert_key'] }}"
